Metadata-Version: 2.4
Name: maowise
Version: 0.1.0
Summary: Micro-Arc Oxidation Thermal-Control Coating Optimizer
Author-email: MAO-Wise Team <maowise@example.com>
License: MIT
Project-URL: Homepage, https://github.com/your-org/mao-wise
Project-URL: Documentation, https://github.com/your-org/mao-wise#readme
Project-URL: Repository, https://github.com/your-org/mao-wise.git
Project-URL: Bug Tracker, https://github.com/your-org/mao-wise/issues
Keywords: materials,coating,optimization,machine-learning
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Scientific/Engineering :: Chemistry
Classifier: Topic :: Scientific/Engineering :: Materials Science
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi>=0.68.0
Requires-Dist: uvicorn[standard]>=0.15.0
Requires-Dist: streamlit>=1.28.0
Requires-Dist: pydantic>=1.8.0
Requires-Dist: requests>=2.25.0
Requires-Dist: pyyaml>=5.4.0
Requires-Dist: pandas>=1.3.0
Requires-Dist: numpy>=1.21.0
Requires-Dist: scikit-learn>=1.0.0
Requires-Dist: sentence-transformers>=2.0.0
Requires-Dist: faiss-cpu>=1.7.0
Requires-Dist: loguru>=0.5.0
Requires-Dist: pymupdf>=1.18.0
Requires-Dist: camelot-py[cv]>=0.10.0
Requires-Dist: tabula-py>=2.2.0
Requires-Dist: pdfminer.six>=20211012
Requires-Dist: pytesseract>=0.3.8
Requires-Dist: torch>=1.9.0
Requires-Dist: botorch>=0.6.0
Requires-Dist: pymoo>=0.6.0
Requires-Dist: mlflow>=1.20.0
Requires-Dist: spacy>=3.4.0
Requires-Dist: chromadb>=0.3.0
Requires-Dist: dvc[s3]>=2.30.0
Requires-Dist: pyarrow>=5.0.0
Requires-Dist: openai>=1.0.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.12; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: ruff>=0.0.200; extra == "dev"
Requires-Dist: isort>=5.9; extra == "dev"
Requires-Dist: pre-commit>=2.15; extra == "dev"
Provides-Extra: test
Requires-Dist: pytest>=6.0; extra == "test"
Requires-Dist: pytest-cov>=2.12; extra == "test"
Requires-Dist: httpx>=0.24.0; extra == "test"
Requires-Dist: selenium>=4.0.0; extra == "test"
Requires-Dist: webdriver-manager>=3.8.0; extra == "test"
Provides-Extra: all
Requires-Dist: maowise[dev,test]; extra == "all"
Dynamic: license-file

# MAO-Wise 1.0 (Micro-Arc Oxidation Thermal-Control Coating Optimizer)

![ci](https://github.com/Planckyo/mao-wise/actions/workflows/ci.yml/badge.svg)
![kb-smoke](https://github.com/Planckyo/mao-wise/actions/workflows/kb-smoke.yml/badge.svg)

MAO-Wise 是一个端到端的微弧氧化工艺知识与优化系统，包含：
- PDF → 结构化样本抽取（可追溯）
- 向量知识库（FAISS/NumPy 备选）
- 正向预测（文本→α/ε）
- 反向优化（目标→可执行多方案）
- FastAPI 服务与 Streamlit UI
- 数据/模型版本化与基础 MLOps（DVC/MLflow）

## 目录结构

```
mao-wise/
├─ apps/
│  ├─ api/                  # FastAPI 服务
│  └─ ui/                   # Streamlit 前端
├─ maowise/
│  ├─ config/               # 配置与schema
│  ├─ dataflow/             # 模块一：PDF抽取→结构化
│  ├─ kb/                   # 模块四：向量库
│  ├─ models/               # 模块二：正向模型
│  ├─ optimize/             # 模块三：反向优化
│  ├─ utils/                # 公共工具、日志、校验
│  └─ api_schemas/          # Pydantic请求/响应模型
├─ datasets/                # 本地数据区（gitignore）
│  ├─ data_raw/             # PDF/原始数据
│  ├─ data_parsed/          # 解析中间件
│  ├─ index_store/          # 向量索引/通道
│  └─ versions/             # 结构化样本&发布数据集
├─ models_ckpt/             # 训练后的模型权重（gitignore）
├─ scripts/                 # 训练/评测/构建脚本
├─ tests/                   # 单元与端到端测试
├─ requirements.txt
├─ .env.example
├─ README.md
└─ LICENSE
```

## 🧪 端到端测试（E2E）

### 一键测试验收

MAO-Wise 提供完整的端到端测试系统，自动验证所有关键功能：

**Windows 一键运行**：
```powershell
# 在项目根目录执行
.\scripts\run_e2e.ps1
```

**Linux/macOS 手动运行**：
```bash
# 数据准备
python scripts/e2e_data_prep.py

# 执行测试
python scripts/e2e_validate.py
```

### 测试覆盖范围

- ✅ **API服务启动**：自动启动并检查服务健康状态
- ✅ **预测澄清流程**：测试缺失参数时的专家咨询机制
- ✅ **必答问题系统**：验证必答清单和智能追问功能
- ✅ **规则修复引擎**：测试违规参数的自动修复
- ✅ **RAG解释系统**：验证引用生成和解释质量
- ✅ **治理与缓存**：测试速率限制、成本控制和缓存命中

### 测试报告

测试完成后自动生成详细报告：

- **Markdown报告**：`reports/e2e_report.md`
- **HTML报告**：`reports/e2e_report.html`

报告包含：
- 📊 测试通过率和耗时统计
- 📋 每个测试项的详细结果
- 🔧 系统配置和运行模式信息
- 💡 失败项目的修复建议

### 环境配置

**可选环境变量**：
```powershell
# 启用在线LLM功能
$env:OPENAI_API_KEY = "sk-your-api-key"

# 使用本地文献库（支持中文路径）
$env:MAOWISE_LIBRARY_DIR = "D:\桌面\本地PDF文献知识库"

# 启用详细调试日志
$env:DEBUG_LLM = "true"
```

**离线兜底模式**：
- 无需API密钥即可运行完整测试
- 自动使用最小数据夹具进行功能验证
- 确保核心功能在离线环境下正常工作

---

## 快速开始（本地开发）

1) 安装依赖（Windows 需额外安装 Tesseract OCR 与 Java（用于 Tabula，可选））

**方法一：开发包安装（推荐）**
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
# source .venv/bin/activate  # Linux/Mac
pip install -e .
```

**方法二：传统依赖安装**
```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

2) 准备数据：将 PDF 放入 `datasets/data_raw/`

3) 抽取 → 样本

```
python -m maowise.dataflow.ingest --pdf_dir datasets/data_raw --out_dir datasets/versions/maowise_ds_v1
```

4) 构建知识库

```
python -m maowise.kb.build_index --corpus datasets/data_parsed/corpus.jsonl --out_dir datasets/index_store
```

5) 训练正向模型

```
python -m maowise.models.train_fwd --samples datasets/versions/maowise_ds_v1/samples.parquet \
  --model_name bert-base-multilingual-cased --out_dir models_ckpt/fwd_v1 --epochs 8 --lr 2e-5 --batch 16
```

6) 启动 API 与 UI

```
uvicorn apps.api.main:app --reload
streamlit run apps/ui/app.py
```

### 快速命令（开发）
- 初始化依赖与钩子：`make init`
- 代码检查（格式化+lint+单测）：`make check`

### 本地库接入（Windows 中文路径）
```
chcp 65001 > $null
$env:MAOWISE_LIBRARY_DIR="D:\桌面\本地PDF文献知识库"
powershell -ExecutionPolicy Bypass -File scripts\link_local_library.ps1 -UseOCR:$false -DoTrain:$false
# 如需立即训练：
# powershell -ExecutionPolicy Bypass -File scripts\link_local_library.ps1 -UseOCR:$false -DoTrain:$true
```

## 本地一键运行（Windows + 中文路径）

> 需要安装依赖：`pip install -r requirements.txt`；若使用 OCR/Tabula，请额外安装 Tesseract/Java。

```powershell
# 1) 写入 .env（可修改路径）
powershell -ExecutionPolicy Bypass -File scripts\bootstrap_env.ps1 -LibraryDir "D:\桌面\本地PDF文献知识库"

# 2) 一键接入库（不训练）
powershell -ExecutionPolicy Bypass -File scripts\pipeline_local.ps1 -UseOCR:$false -DoTrain:$false

# 3) （可选）开始训练与评测
powershell -ExecutionPolicy Bypass -File scripts\pipeline_local.ps1 -DoTrain:$true

# 4) 启动 API + UI 并自测
powershell -ExecutionPolicy Bypass -File scripts\start_services.ps1

# 5) 需要时停止服务
powershell -ExecutionPolicy Bypass -File scripts\stop_services.ps1
```

常见产物：
- `manifests/manifest_{train,val,test}.csv`, `split_meta.json`
- `datasets/versions/maowise_ds_v1/samples.parquet`（带 split）
- `datasets/data_parsed/corpus.jsonl`，`datasets/index_store/`
- 训练产物：`models_ckpt/fwd_v1/`，报告在 `reports/`

### 数据与 DVC 治理
- 不要将大文件（PDF/模型权重/索引）直接提交到 Git。
- 使用 DVC 追踪数据与索引（远端地址通过 `DVC_REMOTE_URL` 配置）。

## API 端点
- POST `/api/maowise/v1/ingest`
- POST `/api/maowise/v1/predict`
- POST `/api/maowise/v1/recommend`
- POST `/api/maowise/v1/kb/search`

## 备注
- 首版优先打通端到端最小可用路径；精度与鲁棒性随数据迭代。
- 置信度来源于相似案例的相似度，仅供排序与提示。
- DVC/MLflow 钩子就绪，可按需启用。

